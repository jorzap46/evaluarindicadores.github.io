<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evaluación de Indicadores</title>
  <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f9fa;
      /*color: #fff;*/
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      padding: 1rem;
      background-color: #00B8CB;
    }
    .container {
      padding: 1rem;
    }
    .category {
      margin-bottom: 2rem;
    }
    .indicator {
      margin: 0.5rem 0;
    }
    .indicator label {
      margin-right: 1rem;
    }
    .pagination {
      text-align: center;
      margin: 1rem 0;
    }
    .summary {
      margin: 2rem auto;
      max-width: 700px;
      padding: 1rem;
      background-color: #1a1a1a;
      border-radius: 10px;
    }
    .summary h3 {
      margin-top: 1.5rem;
    }
    canvas.summary-chart {
      max-width: 300px;
      margin-top: 1rem;
    }
    .show-summary-btn {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
    }
    .show-summary-btn button {
      background-color: #2196f3;
      color: white;
      padding: 0.5rem 1.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .form-section {
      max-width: 420px;
      margin: 2rem auto;
      padding: 1rem;
      /*background-color: #1a1a1a;*/
      background-color: #00B8CB;
      border-radius: 10px;
    }
    
    .form-section input {
      width: 95%;      
    }
    .form-section select {
      width: 98%;      
    }
    .form-section input, .form-section select {
      
      padding: 0.5rem;
      margin: 0.5rem 0;
      border-radius: 5px;
      border: none;
    }
    .form-section button {
      width: 100%;
      padding: 0.5rem;
      /*background-color: #4caf50;*/
      background-color:blueviolet;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>Evaluación de Indicadores Humanizados</h1>
  </header>

  <div class="form-section" id="user-form">
    
    <h2>Datos del Evaluador <i class='bx  bx-contact-book'  ></i> </h2>

    <input type="text" id="nombresE" placeholder="Nombres" required />
    <input type="text" id="apellidosE" placeholder="Apellidos" required />
    <h2>Datos del Evaluado</h2>
    <input type="text" id="nombres" placeholder="Nombres" required />
    <input type="text" id="apellidos" placeholder="Apellidos" required />
    <select id="sexo" required>
      <option value="">Seleccione sexo</option>
      <option value="Masculino">Masculino</option>
      <option value="Femenino">Femenino</option>
    </select>
    <input type="text" id="ciclo" placeholder="Ciclo qu cursa" required />
    <input type="date" id="fecha" placeholder="Fecha de Evaluación" required />
    <button onclick="startEvaluation()">Iniciar Evaluación</button>
  </div>

  <div class="container" id="form-container" style="display:none;"></div>
  <div class="pagination" id="pagination" style="display:none;">
    <button onclick="prevPage()">Anterior</button>
    <span id="page-indicator"></span>
    <button onclick="nextPage()">Siguiente</button>
  </div>
  <div class="show-summary-btn" id="summary-btn" style="display:none;">
    <button onclick="showSummary()">Ver Estadísticas</button>
  </div>
  <div class="summary" id="summary" style="display:none">
    <h2>Resumen Final</h2>
    <div id="summary-details"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const indicadores = {
      SENSIBILIDAD: ["Afectividad", "Trato delicado"],
      SEGURIDAD: ["Expresión de ternura", "Seguridad al cogerle la mano", "enmienda sus errores", "Autonomía"],
      COMUNICACIÓN: ["Inicio de la interacción con un elogio y tono suave", "Saludo verbal y cordial", "Saludo no verbal y acogedor", "Interactúa presentándose", "Presta atención al contacto visual", "Escucha activa", "Orientación al ingreso al servicio", "Permite que el paciente exprese sus ideas", "Permite la manifestación de emociones del paciente", "El lenguaje es de acuerdo al nivel cultural"],
      RESPETO: ["Respeta a la persona evitando diminutivos o familiaridades", "Muestra atención y respeto", "Respeto por el espacio personal del paciente.", "Conservar la individualidad", "Ser apoyo en momento que peligra la vida", "Trato equitativo y respetuoso", "Respeta las diferencias culturales del paciente"],
      EMPATÍA: ["Colocarse en lugar del otro", "Capacidad de comprender sentimientos", "Se muestra solidaria", "Ayuda a la solución de problemas"],
      PACIENCIA: ["Respeto por los silencios del paciente", "Utiliza el tiempo suficiente para responder a preguntas del paciente", "Atención sin prisa", "Mostrar cercanía"],
      COMPROMISO: ["Mostrar interés por la problemática", "Motivación al paciente", "Práctica de confidencialidad", "Motivación a la esperanza", "Aboga por las necesidades y los derechos del paciente"],
      COMPRENSIÓN: ["Mantiene la compostura y utiliza estrategias de apoyo para calmar", "Brinda palabras de aliento y apoyo constante", "Trato como a un ser humano", "Reconocimiento al otro", "Cuidar para la trascendencia"],
      ACEPTACIÓN: ["Sin distinción de raza", "Aceptación a las manifestaciones de las prácticas religiosas", "Uso del Toque terapéutico", "Acepta la historia personal del paciente", "Evita reacciones punitivas y de rechazo", "Evita juicios y críticas"],
      ASERTIVIDAD: ["Ser un elemento terapéutico", "Mostrar firmeza en decisiones", "Utiliza un lenguaje firme pero respetuoso", "Evita rodeos, indirectas e insinuaciones", "Evita sarcasmo o lenguaje pasivo-agresivo para comunicar sus puntos de vista"],
      DIGNIDAD: ["Llamar por su nombre", "Asegura la confiabilidad", "Asegura la privacidad durante las intervenciones", "Respeta la intimidad como persona", "Mantiene la confidencialidad"],
      ESTÉTICA: ["Coherencia en la comunicación verbal y no verbal", "Armonía entre lo que se dice y hace", "Secuencia y armonía en las acciones"]
    };

    let page = 0;
    const categorias = Object.keys(indicadores);
    let datosPersona = {};

    function startEvaluation() {
      const nombres = document.getElementById("nombres").value.trim();
      const apellidos = document.getElementById("apellidos").value.trim();
      const sexo = document.getElementById("sexo").value;

      if (!nombres || !apellidos || !sexo) {
        alert("Por favor complete todos los campos.");
        return;
      }
      datosPersona = { nombres, apellidos, sexo };

      document.getElementById("user-form").style.display = "none";
      document.getElementById("form-container").style.display = "block";
      document.getElementById("pagination").style.display = "block";
      document.getElementById("summary-btn").style.display = "flex";

      renderPage();
    }

    function saveResponse(category, indicator, value) {
      let data = JSON.parse(localStorage.getItem('evaluacion') || '{}');
      if (!data[category]) data[category] = {};
      data[category][indicator] = value;
      localStorage.setItem('evaluacion', JSON.stringify(data));
    }

    function renderPage() {
      const container = document.getElementById("form-container");
      if (!categorias[page] || !indicadores[categorias[page]]) {
        container.innerHTML = "<p>Error al cargar la categoría. Por favor, reinicie la evaluación.</p>";
        return;
      }
      const currentCategory = categorias[page];
      const items = indicadores[currentCategory];
      container.innerHTML = `<div class="category"><h2>${currentCategory}</h2>${items
        .map(ind => {
          const name = `${currentCategory}-${ind}`;
          return `<div class="indicator"><strong>${ind}</strong><br>
            <label><input type="radio" name="${name}" value="Logrado" onchange="saveResponse('${currentCategory}', '${ind}', this.value)"> Logrado</label>
            <label><input type="radio" name="${name}" value="En Proceso" onchange="saveResponse('${currentCategory}', '${ind}', this.value)"> En Proceso</label>
            <label><input type="radio" name="${name}" value="No Logrado" onchange="saveResponse('${currentCategory}', '${ind}', this.value)"> No Logrado</label>
          </div>`;
        }).join("")}</div>`;

      document.getElementById("page-indicator").textContent = `Página ${page + 1} de ${categorias.length}`;
    }

    function nextPage() {
      if (page < categorias.length - 1) {
        page++;
        renderPage();
      }
    }
    function prevPage() {
      if (page > 0) {
        page--;
        renderPage();
      }
    }

    function showSummary() {
      const data = JSON.parse(localStorage.getItem("evaluacion") || '{}');
      const summaryContainer = document.getElementById("summary");
      const summaryDetails = document.getElementById("summary-details");
      summaryDetails.innerHTML = '';

      let totalPuntos = 0;
      Object.keys(indicadores).forEach(cat => {
        const respuestas = data[cat] || {};
        for (let ind of indicadores[cat]) {
          const val = respuestas[ind];
          if (val === "Logrado") totalPuntos += 3;
          else if (val === "En Proceso") totalPuntos += 2;
          else if (val === "No Logrado") totalPuntos += 1;
        }
      });

      let resultadoTexto = "";
      if (totalPuntos >= 60 && totalPuntos <= 100) {
        resultadoTexto = "NO HA INICIADO AÚN UNA RELACIÓN DE AYUDA";
      } else if (totalPuntos >= 101 && totalPuntos <= 140) {
        resultadoTexto = "RELACIÓN DE AYUDA EN PROCESO";
      } else if (totalPuntos >= 141 && totalPuntos <= 180) {
        resultadoTexto = "RELACIÓN DE AYUDA ESTABLECIDA";
      }

      summaryDetails.innerHTML = `
        <p><strong>Evaluado:</strong> ${datosPersona.nombres} ${datosPersona.apellidos} (${datosPersona.sexo})</p>
        <h3>Puntaje Total: ${totalPuntos}</h3>
        <p><strong>Resultado:</strong> ${resultadoTexto}</p>
        <canvas id="resultadoChart" class="summary-chart"></canvas>
      `;

      setTimeout(() => {
        const ctx = document.getElementById("resultadoChart").getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["No Iniciado", "En Proceso", "Establecida"],
            datasets: [{
              label: 'Puntaje Total',
              data: [
                totalPuntos >= 60 && totalPuntos <= 100 ? totalPuntos : 100,
                totalPuntos >= 101 && totalPuntos <= 140 ? totalPuntos : 140,
                totalPuntos >= 141 ? totalPuntos : 180
              ],
              backgroundColor: [
                totalPuntos <= 100 ? '#f44336' : '#555',
                totalPuntos > 100 && totalPuntos <= 140 ? '#ff9800' : '#555',
                totalPuntos > 140 ? '#4caf50' : '#555'
              ]
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                max: 180,
                ticks: { color: "#fff" }
              },
              x: {
                ticks: { color: "#fff" }
              }
            },
            plugins: {
              legend: {
                labels: { color: "#fff" }
              }
            }
          }
        });
      }, 100);

      summaryContainer.style.display = 'block';
    }
  </script>
</body>
</html>
